<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Whiteframe Test</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }
    .controls {
      margin: 20px;
    }
    #previewContainer {
      max-width: 90vw;
      max-height: 90vh;
      overflow: auto;
      margin: auto;
      border: 1px solid #444;
    }
    #preview {
      display: block;
      width: 100%;
      height: auto;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Whiteframe Test</h1>
  <div class="controls">
    <input type="file" id="imageInput">
    <select id="ratioSelect">
      <option>3:2</option>
      <option>4:3</option>
      <option>5:4</option>
      <option>7:6</option>
      <option>16:10</option>
      <option>16:9</option>
      <option>2:1</option>
      <option>2.35:1</option>
      <option>3:1</option>
      <option>1:1</option>
    </select>
    <select id="orientationSelect">
      <option value="landscape">背景：横</option>
      <option value="portrait">背景：縦</option>
    </select>
    <select id="marginSelect">
      <option value="50">50px</option>
      <option value="100" selected>100px</option>
      <option value="200">200px</option>
    </select>
    <button id="addFrameBtn">枠を追加</button>
  </div>

  <div id="previewContainer">
    <img id="preview" />
    <canvas id="canvas"></canvas>
  </div>

  <script>
    const imageInput = document.getElementById('imageInput');
    const ratioSelect = document.getElementById('ratioSelect');
    const orientationSelect = document.getElementById('orientationSelect');
    const marginSelect = document.getElementById('marginSelect');
    const preview = document.getElementById('preview');
    const canvas = document.getElementById('canvas');

    let loadedImage = new Image();

    imageInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = event => {
        loadedImage.onload = () => {
          preview.src = loadedImage.src;
        };
        loadedImage.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function parseRatio(ratioStr, orientation) {
      let [w, h] = ratioStr.split(':').map(Number);
      if (orientation === 'portrait') [w, h] = [h, w]; // 自動で縦横変換
      return { w, h };
    }

    document.getElementById('addFrameBtn').addEventListener('click', () => {
      const ratioStr = ratioSelect.value;
      const orientation = orientationSelect.value;
      const margin = parseInt(marginSelect.value, 10);
      const { w: rw, h: rh } = parseRatio(ratioStr, orientation);

      const imgW = loadedImage.width;
      const imgH = loadedImage.height;
      const imgAspect = imgW / imgH;
      const bgAspect = rw / rh;

      let targetW, targetH;
      if (imgAspect > bgAspect) {
        // 横が余る
        targetH = imgH + margin * 2;
        targetW = targetH * bgAspect;
      } else {
        // 縦が余る
        targetW = imgW + margin * 2;
        targetH = targetW / bgAspect;
      }

      canvas.width = targetW;
      canvas.height = targetH;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const x = (canvas.width - imgW) / 2;
      const y = (canvas.height - imgH) / 2;
      ctx.drawImage(loadedImage, x, y);

      preview.src = canvas.toDataURL('image/jpeg');
    });
  </script>
</body>
</html>
