<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Whiteframe</title>
  <style>
    body {
      background-color: #000;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding: 1em;
    }
    canvas {
      margin: 1em 0;
      background-color: white;
      max-width: 100%;
      height: auto;
    }
    select, input, button {
      margin: 0.5em;
      padding: 0.5em;
      font-size: 1em;
    }
    .controls {
      margin-bottom: 1em;
    }
    .toggle-button {
      background: #333;
      color: white;
      border: 1px solid #555;
    }
    .toggle-button.active {
      background: white;
      color: black;
    }
  </style>
</head>
<body>
  <h1>Whiteframe</h1>

  <input type="file" id="imageInput" accept="image/*"><br>

  <div class="controls">
    <label>枠の太さ：</label>
    <select id="borderWidth">
      <option value="50">50px</option>
      <option value="100" selected>100px</option>
      <option value="200">200px</option>
    </select>
    <input type="number" id="customBorderWidth" placeholder="カスタム(px)">
  </div>

  <div class="controls">
    <label>背景紙の比率：</label>
    <select id="aspectRatio">
      <option value="none">変更なし</option>
      <option value="1">1:1</option>
      <option value="1.5">3:2</option>
      <option value="1.333">4:3</option>
      <option value="1.777">16:9</option>
      <option value="1.6">16:10</option>
      <option value="2">2:1</option>
      <option value="2.35">2.35:1</option>
      <option value="3">3:1</option>
      <option value="1.1667">7:6</option>
      <option value="0.8">4:5</option>
    </select>
    <input type="number" id="customAspectRatio" placeholder="カスタム比率（幅÷高さ）">
  </div>

  <button id="orientationToggle" class="toggle-button">背景：横</button>
  <button onclick="addWhiteFrame()">白枠を追加</button><br>

  <canvas id="canvas"></canvas><br>
  <a id="downloadLink" style="display:none" download="whiteframed.jpg">画像を保存</a>

  <script>
    let img = new Image();
    let isVertical = false;

    document.getElementById('orientationToggle').addEventListener('click', () => {
      isVertical = !isVertical;
      const btn = document.getElementById('orientationToggle');
      btn.textContent = isVertical ? "背景：縦" : "背景：横";
    });

    document.getElementById('imageInput').addEventListener('change', e => {
      const reader = new FileReader();
      reader.onload = function (event) {
        img.onload = () => drawCanvas();
        img.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    function getBorderWidth() {
      const custom = parseInt(document.getElementById('customBorderWidth').value);
      return isNaN(custom) ? parseInt(document.getElementById('borderWidth').value) : custom;
    }

    function getAspectRatio() {
      const ratioSelect = document.getElementById('aspectRatio').value;
      const custom = parseFloat(document.getElementById('customAspectRatio').value);
      if (!isNaN(custom)) return custom;
      return ratioSelect === 'none' ? null : parseFloat(ratioSelect);
    }

    function addWhiteFrame() {
      if (!img.src) return;
      drawCanvas();
    }

    function drawCanvas() {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const border = getBorderWidth();
      let ratio = getAspectRatio();

      let imgW = img.width;
      let imgH = img.height;

      if (isVertical && ratio) ratio = 1 / ratio;

      let bgW = imgW + border * 2;
      let bgH = imgH + border * 2;

      if (ratio) {
        if ((imgW / imgH) > ratio) {
          bgW = imgW + border * 2;
          bgH = bgW / ratio;
        } else {
          bgH = imgH + border * 2;
          bgW = bgH * ratio;
        }
      }

      canvas.width = bgW;
      canvas.height = bgH;

      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const offsetX = (canvas.width - imgW) / 2;
      const offsetY = (canvas.height - imgH) / 2;
      ctx.drawImage(img, offsetX, offsetY);

      document.getElementById('downloadLink').style.display = 'inline';
      document.getElementById('downloadLink').href = canvas.toDataURL('image/jpeg');
    }
  </script>
</body>
</html>
