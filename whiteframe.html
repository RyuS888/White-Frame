<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Whiteframe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding: 10px;
    }

    input, select, button {
      font-size: 1.2em;
      margin: 8px;
    }

    canvas {
      display: block;
      margin: 10px auto;
      background: white;
    }

    #outputImage {
      margin-top: 10px;
      max-width: 100%;
      display: none;
    }

    label, .control-group {
      display: block;
      margin: 12px 0;
    }

    .control-group {
      padding: 10px;
      border: 1px solid #444;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>Whiteframe</h1>

  <div class="control-group">
    <label>画像を選択:</label>
    <input type="file" id="imageInput" accept="image/*">
  </div>

  <div class="control-group">
    <label>枠の太さ (px):</label>
    <select id="borderWidth">
      <option value="50">50</option>
      <option value="100" selected>100</option>
      <option value="200">200</option>
      <option value="custom">カスタム</option>
    </select>
    <input type="number" id="customWidth" placeholder="pxを入力" style="display:none;">
  </div>

  <div class="control-group">
    <label>背景紙の比率:</label>
    <select id="canvasRatio">
      <option value="original">オリジナル</option>
      <option value="1:1">1:1</option>
      <option value="3:2">3:2</option>
      <option value="4:3">4:3</option>
      <option value="5:4">5:4</option>
      <option value="16:9">16:9</option>
      <option value="2:3">2:3</option>
      <option value="3:4">3:4</option>
      <option value="4:5">4:5</option>
      <option value="9:16">9:16</option>
      <option value="custom">カスタム</option>
    </select>
    <input type="text" id="customRatio" placeholder="例: 7:5" style="display:none;">
  </div>

  <button id="addFrameBtn">枠を追加</button>
  <a id="downloadBtn" style="display:none;" download><button>画像を保存</button></a>

  <canvas id="canvas"></canvas>
  <img id="outputImage" alt="framed image">

  <script>
    const imageInput = document.getElementById('imageInput');
    const borderWidthSelect = document.getElementById('borderWidth');
    const customWidthInput = document.getElementById('customWidth');
    const canvasRatioSelect = document.getElementById('canvasRatio');
    const customRatioInput = document.getElementById('customRatio');
    const addFrameBtn = document.getElementById('addFrameBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let image = new Image();

    borderWidthSelect.addEventListener('change', () => {
      customWidthInput.style.display = borderWidthSelect.value === 'custom' ? 'inline-block' : 'none';
    });

    canvasRatioSelect.addEventListener('change', () => {
      customRatioInput.style.display = canvasRatioSelect.value === 'custom' ? 'inline-block' : 'none';
    });

    imageInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        image.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });

    addFrameBtn.addEventListener('click', () => {
      if (!image.src) return;

      const borderWidth = borderWidthSelect.value === 'custom'
        ? parseInt(customWidthInput.value, 10)
        : parseInt(borderWidthSelect.value, 10);

      const ratioValue = canvasRatioSelect.value;
      let ratioW = image.width;
      let ratioH = image.height;

      if (ratioValue === 'custom' && customRatioInput.value.includes(':')) {
        const [w, h] = customRatioInput.value.split(':').map(Number);
        if (w > 0 && h > 0) {
          ratioW = w;
          ratioH = h;
        }
      } else if (ratioValue !== 'original') {
        const [w, h] = ratioValue.split(':').map(Number);
        if (w && h) {
          ratioW = w;
          ratioH = h;
        }
      }

      const imageRatio = image.width / image.height;
      const canvasRatio = ratioW / ratioH;

      let canvasWidth, canvasHeight;

      if (canvasRatio > imageRatio) {
        canvasHeight = image.height + 2 * borderWidth;
        canvasWidth = canvasHeight * canvasRatio;
      } else {
        canvasWidth = image.width + 2 * borderWidth;
        canvasHeight = canvasWidth / canvasRatio;
      }

      canvas.width = canvasWidth;
      canvas.height = canvasHeight;

      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const x = (canvas.width - image.width) / 2;
      const y = (canvas.height - image.height) / 2;
      ctx.drawImage(image, x, y);

      const dataURL = canvas.toDataURL('image/jpeg', 1.0);
      downloadBtn.href = dataURL;
      downloadBtn.download = imageInput.files[0].name.replace(/\.(jpe?g|png)$/i, '_01.jpg');
      downloadBtn.style.display = 'inline-block';
    });
  </script>
</body>
</html>
